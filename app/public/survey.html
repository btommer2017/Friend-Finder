<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Friend Finder</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="app/public/style.css"> -->
</head>

<body>
    <div class="container">
        <h1 style="text-align: center; font-size: 50px;">FRIEND FINDER</h1>
        <hr>
        <hr>
        <form id="userSurvey">
            <h2>User Information:</h2>
            <div class="form-group">
                <label for="user">Name:</label>
                <input type="text" class="form-control" id="userName">
            </div>
            <div class="form-group">
                <label for="pic">Photo URL (optional):</label>
                <input type="text" class="form-control" id="userPic">
            </div>
            <hr>
            <hr>
            <h2>
                <strong>Provide responses to the following statements:</strong>
            </h2>
            <!-- begin survey -->
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 1</strong>
                </h3>
                <h4>You like wookies</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question1">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 2</strong>
                </h3>
                <h4>You want to be a sith lord</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question2">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 3</strong>
                </h3>
                <h4>You are a good pilot</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question3">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 4</strong>
                </h3>
                <h4>You like all alien species</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question4">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 5</strong>
                </h3>
                <h4>A rancor would not be a tough match</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question5">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 6</strong>
                </h3>
                <h4>You would prefer death via a sarlacc pit instead of a light saber wound</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question6">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 7</strong>
                </h3>
                <h4>You would steal from Jabba the Hutt if you had the chance</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question7">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 8</strong>
                </h3>
                <h4>Your favorite light saber color is green</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question8">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 9</strong>
                </h3>
                <h4>You'd rather live on Tatooine instead of the Death Star</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question9">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <div class="row col-xs-12 col-md-12 col-lg-12">
                <h3>
                    <strong>Answer 10</strong>
                </h3>
                <h4>You prefer the light side of the force</h4>
                <div class="form-group col-xs-3">
                    <select class="form-control" id="question10">
                        <option>1 (strongly agree)</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5 (strongly disagree)</option>
                    </select>
                </div>
            </div>
            <button type="submit" style="background-color: black" class="btn btn-primary btn-lg btn-block" id="submit">
                <i class="fa fa-check-circle" aria-hidden="true"></i>
                Submit Survey Answers</button>
        </form>
        <br>

        <!-- modal friend finder pop up -->
        <div id="results-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">Ã—</button>
                        <h2 class="modal-title">
                            <strong></strong>
                        </h2>
                    </div>
                    <div class="modal-body">
                        <h2 id="match-name"></h2>
                        <img id="match-img" src="" alt="">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- modal div end -->

    </div>


    <script type="text/javascript">
    $("#userName").focus();
  $('#userSurvey').on('keyup keypress', function(e) {
          var keyCode = e.keyCode || e.which;
          if (keyCode === 13) { 
            e.preventDefault();
            return false;
          }
        });
        $('#submit').on("click", function (event) {
            event.preventDefault();
            if ($("#userName").val().trim() === '') {
                alert('Please enter a valid name');
            } else {
                //create a scores array to store users numerical value to each answer
                var scores = [
                    $("#question1").val().substring(0, 1),
                    $("#question2").val().substring(0, 1),
                    $("#question3").val().substring(0, 1),
                    $("#question4").val().substring(0, 1),
                    $("#question5").val().substring(0, 1),
                    $("#question6").val().substring(0, 1),
                    $("#question7").val().substring(0, 1),
                    $("#question8").val().substring(0, 1),
                    $("#question9").val().substring(0, 1),
                    $("#question10").val().substring(0, 1),
                ];

                //create object for new users info and survey results
                var newUser = {
                    name: $("#userName").val().trim(),
                    photo: $("#userPic").val().trim(),
                    scores
                };
                console.log(newUser);
                var currentURL = window.location.origin;
                //store new user with other predefined characters
                $.post(currentURL + "/api/friends", newUser, function (data) {});

                checkScores = function () {
                    console.log("Currently checking scores");
                    $.ajax({
                        url: currentURL + "/api/friends",
                        method: "GET"
                    }).done(function (res) {
                        // find the total number of all predefined characters + already submitted user survey data
                        let userNumber = res.length - 1
                        //create a userDifference number that can have a max value of 50
                        let userDifference = 50;

                        // Filter Data from friends.js for each character
                        for (i = 0; i < userNumber; i++) {
                            //reset totalChecker for new character
                            let totalChecker = [];
                            // Check all 10 score numbers for each character compared to the new users numbers to find who's most compatible
                            for (j = 0; j < res[i].scores.length; j++) {
                                totalChecker.push(Math.abs(scores[j] - res[i].scores[j]));
                            }
                            // find the combined value of all the differences in the totalChecker array
                            function getSum(total, num) {
                                return total + num;
                            }
                            let totalSum = totalChecker.reduce(getSum);
                            console.log(res[i].name + ": " + totalSum);
                            // determine the closest match by looking for the lowest value of all characters totals
                            if (totalSum <= userDifference) {
                                charMatch = res[i].name;
                                charPhoto = res[i].photo;
                                userDifference = totalSum;
                            }
                        }
                        matchResult = "Your closest match is " + charMatch + "!";
                        console.log(matchResult);
                        // NEED TO ADD A WAY TO SHOW THE CURRENT CLOSEST MATCH!!! 
                        $('#results-modal').modal('show');
                        $('#results-modal h2').html(matchResult);
                        if (charPhoto === '') {
                            $('.modal-body').html('<img width ="350px" height="350px" src=' +
                                "https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg" +
                                '>');
                        } else {
                            $('.modal-body').html('<img width ="350px" height="350px" src=' +
                                charPhoto + '>');
                        }
                        $('#userSurvey')[0].reset();
                        $("#userName").focus();
                    })
                }
                checkScores();
            }
            
        })
    </script>
</body>

</html>